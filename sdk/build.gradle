buildscript {
    repositories { jcenter() }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.0'
    }
}

apply plugin: 'com.github.johnrengelman.shadow'

dependencies {
    compile 'org.apache.httpcomponents:httpcore:4.2.5'
    compile 'org.apache.httpcomponents:httpmime:4.2.5'
    compile 'org.apache.httpcomponents:httpclient:4.2.5'
    compile 'org.codehaus.jackson:jackson-mapper-lgpl:1.9.3'

    testCompile project(':test')
}

tasks.check.dependsOn 'shadowJar'

shadowJar {
    relocate 'org.apache', 'com.ifountain.apache'
    relocate 'org.codehaus', 'com.ifountain.codehaus'
}

uploadArchives {
    def uploadOptions = file("${rootProject.buildDir}/uploadOptions.properties")

    if(!uploadOptions.exists()) {
        println "[Uploading NEXUS] Options parameter is not exist. Skipping!"
        return;
    }

    def type = project.version.toString().contains("SNAPSHOT") ? 'snapshots' : 'releases'
    def url = "http://repo.opsgenie.com:9393/content/repositories/${type}"
    def props = new Properties();
    props.load(new FileInputStream(uploadOptions))
    def nexusUser = props.getProperty('nexusUser')
    def nexusPassword = props.getProperty('nexusPassword')
    repositories {
        mavenDeployer {
            repository(url: url) {
                authentication(userName: nexusUser, password: nexusPassword)
            }
        }
    }
}

